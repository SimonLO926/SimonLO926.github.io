<!DOCTYPE html>
<html lang="zh-HK">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TOKYO 2026 | ËÅñÂú∞Â∑°Á¶Æ</title>

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Noto+Sans+TC:wght@400;500;700;900&display=swap"
        rel="stylesheet">

    <style>
        /* --- THEME VARIABLES --- */
        :root {
            /* Light (Tokyo Day) */
            --primary: #1D1D1F;
            --bg: #F5F5F7;
            --surface: #FFFFFF;
            --surface-trans: rgba(255, 255, 255, 0.85);
            --text-primary: #1D1D1F;
            --text-secondary: #86868B;
            --border: rgba(0, 0, 0, 0.06);
            --accent: #007AFF;
            --shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
            --shadow-hover: 0 12px 32px rgba(0, 0, 0, 0.1);

            /* Gradients */
            --g-day1: linear-gradient(135deg, #a18cd1 0%, #fbc2eb 100%);
            --g-day2: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);
            --g-day3: linear-gradient(135deg, #fccb90 0%, #d57eeb 100%);
            --g-day4: linear-gradient(135deg, #e0c3fc 0%, #8ec5fc 100%);
            --g-day5: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            --g-day6: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --g-day7: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);

            --alert-bg: #FFF4F4;
            --alert-text: #E02424;
            --success-bg: #F0FDF4;
            --success-text: #15803D;
        }

        [data-theme="dark"] {
            /* Cyberpunk Night */
            --primary: #FFFFFF;
            --bg: #000000;
            --surface: #1C1C1E;
            --surface-trans: rgba(28, 28, 30, 0.85);
            --text-primary: #F5F5F7;
            --text-secondary: #8E8E93;
            --border: rgba(255, 255, 255, 0.15);
            --accent: #0A84FF;
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
            --shadow-hover: 0 12px 48px rgba(0, 0, 0, 0.7);

            --g-day1: linear-gradient(135deg, #3B2667 0%, #BC78EC 100%);
            --g-day2: linear-gradient(135deg, #F05F57 0%, #36096d 100%);
            --g-day3: linear-gradient(135deg, #F2994A 0%, #F2C94C 100%);
            --g-day4: linear-gradient(135deg, #0F2027 0%, #203A43 50%, #2C5364 100%);
            --g-day5: linear-gradient(135deg, #1A2980 0%, #26D0CE 100%);
            --g-day6: linear-gradient(135deg, #FF416C 0%, #FF4B2B 100%);
            --g-day7: linear-gradient(135deg, #373B44 0%, #4286f4 100%);

            --alert-bg: rgba(224, 36, 36, 0.15);
            --alert-text: #F87171;
            --success-bg: rgba(21, 128, 61, 0.15);
            --success-text: #4ADE80;
        }

        [data-theme="sakura"] {
            /* Sakura Mode */
            --primary: #881337;
            --bg: #FFF1F2;
            --surface: #FFFFFF;
            --surface-trans: rgba(255, 255, 255, 0.9);
            --text-primary: #881337;
            --text-secondary: #BE123C;
            --border: #FECDD3;
            --accent: #FB7185;

            --g-day1: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
            --g-day2: linear-gradient(120deg, #f6d365 0%, #fda085 100%);
            --g-day3: linear-gradient(120deg, #a1c4fd 0%, #c2e9fb 100%);

            --alert-bg: #FFF0F0;
            --alert-text: #D32F2F;
        }

        [data-theme="lavender"] {
            /* Lavender Mode */
            --primary: #4C1D95;
            --bg: #F3E8FF;
            --surface: #FFFFFF;
            --surface-trans: rgba(255, 255, 255, 0.9);
            --text-primary: #5B21B6;
            --text-secondary: #7C3AED;
            --border: #DDD6FE;
            --accent: #8B5CF6;

            --g-day1: linear-gradient(135deg, #E9D5FF 0%, #C084FC 100%);
            --g-day2: linear-gradient(135deg, #D8B4FE 0%, #A855F7 100%);
            --g-day3: linear-gradient(135deg, #C4B5FD 0%, #8B5CF6 100%);

            --alert-bg: #FAF5FF;
            --alert-text: #6D28D9;
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
            background-color: var(--bg);
            color: var(--text-primary);
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transition: background-color 0.4s ease;
        }

        /* --- HEADER --- */
        header {
            background: var(--surface-trans);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border);
            padding: 12px 24px;
            z-index: 100;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }

        .brand h1 {
            font-size: 18px;
            font-weight: 900;
            margin: 0;
            letter-spacing: -0.02em;
        }

        .brand span {
            font-size: 11px;
            color: var(--text-secondary);
            font-weight: 600;
            letter-spacing: 0.05em;
            text-transform: uppercase;
        }

        .controls {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .theme-wrapper {
            position: relative;
            z-index: 200;
        }

        .theme-btn {
            background: var(--surface);
            border: 1px solid var(--border);
            color: var(--text-primary);
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: transform 0.2s;
            position: relative;
            z-index: 201;
        }

        .theme-btn:active {
            transform: scale(0.9);
        }

        .theme-menu {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.5);
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 50px;
            padding: 6px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            opacity: 0;
            pointer-events: none;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            box-shadow: var(--shadow-hover);
            z-index: 200;
        }

        .theme-menu.active {
            opacity: 1;
            pointer-events: auto;
            transform: translate(-50%, 25px) scale(1);
            /* Drop down */
        }

        .theme-option {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: 2px solid transparent;
            transition: transform 0.2s;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .theme-option.hovered {
            transform: scale(1.25);
            border-color: var(--accent);
            z-index: 202;
        }

        .nav-segment {
            background: rgba(120, 120, 128, 0.12);
            padding: 2px;
            border-radius: 8px;
            display: flex;
        }

        .nav-btn {
            border: none;
            background: transparent;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 600;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s;
        }

        .nav-btn.active {
            background: var(--surface);
            color: var(--text-primary);
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.12);
        }

        /* --- VIEW CONTAINERS --- */
        .view-container {
            flex: 1;
            position: relative;
            overflow: hidden;
            display: none;
            opacity: 0;
            transition: opacity 0.4s ease, transform 0.6s cubic-bezier(0.4, 0.0, 0.2, 1);
            transform-origin: left center;
            backface-visibility: hidden;
        }

        .view-container.active-view {
            display: flex;
            opacity: 1;
            animation: pageFlipIn 0.6s forwards;
        }

        @keyframes pageFlipIn {
            from {
                opacity: 0;
                transform: perspective(1000px) rotateY(-10deg) scale(0.95);
            }

            to {
                opacity: 1;
                transform: perspective(1000px) rotateY(0) scale(1);
            }
        }

        /* --- VIEW 1: MODERN BENTO GRID (OVERVIEW) --- */
        #view-overview {
            padding: 24px;
            overflow-y: auto;
            width: 100%;
        }

        .bento-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            max-width: 1000px;
            margin: 0 auto;
            padding-bottom: 40px;
        }

        .bento-card {
            border-radius: 24px;
            overflow: hidden;
            box-shadow: var(--shadow);
            cursor: pointer;
            position: relative;
            height: 180px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1), box-shadow 0.3s;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .bento-card:hover {
            transform: scale(1.03);
            box-shadow: var(--shadow-hover);
            z-index: 10;
        }

        .bento-bg {
            position: absolute;
            inset: 0;
            z-index: 0;
            background-size: cover;
            background-position: center;
            transition: transform 0.6s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        .bento-card:hover .bento-bg {
            transform: scale(1.1);
        }

        .bento-gradient-overlay {
            position: absolute;
            inset: 0;
            z-index: 0;
            opacity: 0.85;
            transition: opacity 0.3s;
            mix-blend-mode: hard-light;
        }

        .bento-card:hover .bento-gradient-overlay {
            opacity: 0.7;
        }

        .bento-icon-bg {
            position: absolute;
            right: -20px;
            bottom: -20px;
            font-size: 140px;
            color: #fff;
            opacity: 0.25;
            transform: rotate(-15deg);
            pointer-events: none;
            z-index: 1;
            transition: transform 0.4s ease;
        }

        .bento-card:hover .bento-icon-bg {
            transform: rotate(-5deg) scale(1.1);
            opacity: 0.3;
        }

        .bento-content {
            position: relative;
            z-index: 2;
            padding: 24px;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            color: #fff;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.15);
        }

        .bento-top {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .day-pill {
            background: rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(12px);
            padding: 6px 12px;
            border-radius: 100px;
            font-size: 12px;
            font-weight: 800;
            letter-spacing: 0.5px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .bento-info h3 {
            margin: 0;
            font-size: 22px;
            font-weight: 900;
            line-height: 1.2;
            margin-bottom: 6px;
        }

        .bento-info p {
            margin: 0;
            font-size: 13px;
            opacity: 0.95;
            font-weight: 500;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        /* --- VIEW 2: SPLIT DETAIL --- */
        #view-detail {
            flex-direction: row;
        }

        .detail-list-panel {
            width: 420px;
            background: var(--surface);
            display: flex;
            flex-direction: column;
            border-right: 1px solid var(--border);
            z-index: 10;
            box-shadow: 4px 0 24px rgba(0, 0, 0, 0.05);
        }

        .date-scroller {
            padding: 12px;
            display: flex;
            gap: 8px;
            overflow-x: auto;
            border-bottom: 1px solid var(--border);
            background: var(--surface);
            flex-shrink: 0;
            scrollbar-width: none;
        }

        .date-scroller::-webkit-scrollbar {
            display: none;
        }

        .date-chip {
            flex: 0 0 auto;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 52px;
            height: 58px;
            border-radius: 12px;
            background: var(--bg);
            border: 1px solid transparent;
            cursor: pointer;
            transition: all 0.2s;
            color: var(--text-secondary);
        }

        .date-chip.active {
            background: var(--accent);
            color: #fff;
            box-shadow: 0 4px 12px rgba(0, 122, 255, 0.3);
            transform: scale(1.05);
        }

        .date-chip span:first-child {
            font-size: 10px;
            font-weight: 700;
            opacity: 0.8;
            margin-bottom: 2px;
        }

        .date-chip span:last-child {
            font-size: 16px;
            font-weight: 800;
        }

        .timeline-wrapper {
            flex: 1;
            overflow-y: auto;
            padding: 24px 20px;
            scroll-behavior: smooth;
        }

        .day-header-block {
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border);
        }

        .day-header-block h2 {
            margin: 0;
            font-size: 24px;
            font-weight: 800;
            color: var(--text-primary);
        }

        .day-header-block p {
            margin: 4px 0 0 0;
            font-size: 13px;
            color: var(--text-secondary);
        }

        .timeline-item {
            display: flex;
            gap: 16px;
            margin-bottom: 24px;
            position: relative;
            cursor: pointer;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: 15px;
            top: 36px;
            bottom: -30px;
            width: 2px;
            background: var(--border);
            z-index: 0;
        }

        .timeline-item:last-child::before {
            display: none;
        }

        .time-col {
            min-width: 32px;
            display: flex;
            flex-direction: column;
            align-items: center;
            z-index: 1;
            position: relative;
        }

        .time-text {
            font-size: 11px;
            font-weight: 700;
            color: var(--text-secondary);
            margin-bottom: 6px;
            z-index: 2;
        }

        .icon-dot {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--surface);
            border: 2px solid transparent;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
            transition: all 0.2s;
            z-index: 2;
            position: relative;
        }

        .type-transport .icon-dot {
            color: #007AFF;
            border-color: #007AFF;
            background: #F0F9FF;
        }

        .type-activity .icon-dot {
            color: #FF2D55;
            border-color: #FF2D55;
            background: #FFF0F5;
        }

        .type-hotel .icon-dot {
            color: #34C759;
            border-color: #34C759;
            background: #F0FFF4;
        }

        .type-poke .icon-dot {
            color: #FF9500;
            border-color: #FFCC00;
            background: #FFFBEB;
        }

        [data-theme="dark"] .type-transport .icon-dot {
            background: rgba(0, 122, 255, 0.2);
        }

        [data-theme="dark"] .type-activity .icon-dot {
            background: rgba(255, 45, 85, 0.2);
        }

        [data-theme="dark"] .type-hotel .icon-dot {
            background: rgba(52, 199, 89, 0.2);
        }

        [data-theme="dark"] .type-poke .icon-dot {
            background: rgba(255, 204, 0, 0.2);
        }

        /* Route Line Container */
        .route-line-container {
            position: absolute;
            top: 45px;
            /* Start below the icon */
            bottom: -45px;
            /* Extend to the next icon */
            width: 40px;
            /* Wide hit area */
            left: 50%;
            transform: translateX(-50%);
            z-index: 1;
            /* Behind icon but clickable */
            cursor: pointer;
            display: flex;
            justify-content: center;
            transition: all 0.2s;
        }

        .route-line-container:hover .route-line-visible {
            background: var(--accent);
            width: 4px;
            box-shadow: 0 0 8px var(--accent);
        }

        .route-line-visible {
            width: 2px;
            background: var(--border);
            height: 100%;
            transition: all 0.2s;
            border-radius: 2px;
        }

        .timeline-item:hover .icon-dot {
            transform: scale(1.15);
        }

        .event-card {
            flex: 1;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 14px;
            transition: all 0.2s;
        }

        .event-card:hover {
            background: var(--bg);
            border-color: var(--accent);
            transform: translateX(4px);
        }

        .event-title {
            font-size: 15px;
            font-weight: 700;
            margin-bottom: 4px;
            color: var(--text-primary);
        }

        .event-desc {
            font-size: 13px;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        .alert-tag {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            margin-top: 8px;
            padding: 4px 10px;
            background: #FEF2F2;
            color: #EF4444;
            font-size: 11px;
            font-weight: 600;
            border-radius: 6px;
        }

        [data-theme="dark"] .alert-tag {
            background: rgba(239, 68, 68, 0.2);
        }

        .nav-link {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            margin-top: 10px;
            padding: 6px 12px;
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 100px;
            font-size: 11px;
            font-weight: 600;
            color: var(--text-primary);
            text-decoration: none;
            transition: all 0.2s;
        }

        .nav-link:hover {
            background: var(--accent);
            color: #fff;
            border-color: var(--accent);
        }

        .map-container {
            flex: 1;
            background: var(--bg);
            position: relative;
        }

        #map {
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        /* --- VIEW 3: CHECKLIST & NOTES (NEW) --- */
        #view-checklist {
            padding: 24px;
            overflow-y: auto;
            width: 100%;
            background: var(--bg);
        }

        .checklist-container {
            max-width: 800px;
            margin: 0 auto;
            padding-bottom: 40px;
        }

        .section-title {
            font-size: 20px;
            font-weight: 800;
            margin-bottom: 16px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Action Grid for Pre-purchase */
        .action-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 16px;
            margin-bottom: 32px;
        }

        .action-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 16px;
            display: flex;
            align-items: center;
            gap: 12px;
            box-shadow: var(--shadow);
        }

        .check-circle {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border: 2px solid var(--border);
            background: var(--bg);
            cursor: pointer;
            transition: all 0.2s;
            flex-shrink: 0;
        }

        .check-circle.checked {
            background: var(--accent);
            border-color: var(--accent);
            position: relative;
        }

        .check-circle.checked::after {
            content: '‚úì';
            color: white;
            font-size: 14px;
            font-weight: bold;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        /* Strategy Card */
        .strategy-card {
            background: var(--surface);
            border-radius: 20px;
            padding: 24px;
            margin-bottom: 32px;
            border: 1px solid var(--accent);
            position: relative;
            overflow: hidden;
        }

        /* --- PASSWORD OVERLAY --- */
        #password-overlay {
            position: fixed;
            inset: 0;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 1;
            transition: opacity 0.5s ease;
        }

        [data-theme="dark"] #password-overlay {
            background: rgba(0, 0, 0, 0.4);
        }

        .password-container {
            background: var(--surface);
            padding: 40px;
            border-radius: 24px;
            box-shadow: var(--shadow-hover);
            text-align: center;
            max-width: 320px;
            width: 90%;
            border: 1px solid var(--border);
            transform: scale(1);
            transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .password-icon {
            width: 60px;
            height: 60px;
            background: var(--bg);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: var(--accent);
            margin: 0 auto 20px;
        }

        .password-container h2 {
            margin: 0 0 8px;
            font-size: 24px;
            font-weight: 800;
        }

        .password-container p {
            margin: 0 0 24px;
            color: var(--text-secondary);
            font-size: 14px;
        }

        .input-group {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
        }

        #password-input {
            flex: 1;
            padding: 12px 16px;
            border-radius: 12px;
            border: 1px solid var(--border);
            background: var(--bg);
            color: var(--text-primary);
            font-size: 16px;
            outline: none;
            transition: border-color 0.2s;
        }

        #password-input:focus {
            border-color: var(--accent);
        }

        #password-submit {
            width: 48px;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 16px;
            transition: transform 0.2s;
        }

        #password-submit:active {
            transform: scale(0.95);
        }

        .error-msg {
            color: var(--alert-text);
            font-size: 13px;
            height: 20px;
            font-weight: 600;
        }

        .shake {
            animation: shake 0.4s cubic-bezier(.36, .07, .19, .97) both;
        }

        @keyframes shake {

            10%,
            90% {
                transform: translate3d(-1px, 0, 0);
            }

            20%,
            80% {
                transform: translate3d(2px, 0, 0);
            }

            30%,
            50%,
            70% {
                transform: translate3d(-4px, 0, 0);
            }

            40%,
            60% {
                transform: translate3d(4px, 0, 0);
            }
        }

        .strategy-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 6px;
            height: 100%;
            background: var(--accent);
        }

        .strategy-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
        }

        .strategy-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .option-box {
            background: var(--bg);
            padding: 12px;
            border-radius: 12px;
            margin-top: 10px;
        }

        .option-title {
            font-size: 14px;
            font-weight: 700;
            margin-bottom: 4px;
            color: var(--text-primary);
        }

        .option-desc {
            font-size: 13px;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        /* Daily Cheat Sheet */
        .cheat-sheet-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .cheat-item {
            background: var(--surface);
            padding: 16px;
            border-radius: 16px;
            border: 1px solid var(--border);
            display: flex;
            gap: 16px;
        }

        .cheat-day {
            font-size: 14px;
            font-weight: 800;
            color: var(--accent);
            min-width: 50px;
            display: flex;
            align-items: center;
        }

        .cheat-content h4 {
            margin: 0 0 4px 0;
            font-size: 15px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .cheat-content ul {
            margin: 0;
            padding-left: 20px;
            font-size: 13px;
            color: var(--text-secondary);
        }

        .cheat-content li {
            margin-bottom: 4px;
        }

        /* Responsive */
        @media (max-width: 900px) {
            #view-detail {
                flex-direction: column;
            }

            .detail-list-panel {
                width: 100%;
                height: 55%;
                order: 2;
                border-right: none;
                border-top: 1px solid var(--border);
            }

            .map-container {
                width: 100%;
                height: 45%;
                order: 1;
            }

            .bento-grid {
                grid-template-columns: 1fr;
            }

            .date-scroller {
                padding: 12px;
            }

            .nav-btn {
                font-size: 12px;
                padding: 6px 10px;
            }
        }
    </style>
</head>

<body>

    <header>
        <div class="brand">
            <h1><i class="fas fa-torii-gate" style="color:var(--accent); margin-right:8px;"></i>TOKYO 2026</h1>
            <span>ËÅñÂú∞Â∑°Á¶Æ & Ê≤≥Âè£Êπñ</span>
        </div>
        <div class="controls">
            <div class="theme-wrapper" id="theme-wrapper">
                <button class="theme-btn" id="theme-btn" title="ÂàáÊèõ‰∏ªÈ°å (Èï∑ÊåâÈÅ∏Êìá)">
                    <i class="fas fa-adjust"></i>
                </button>
                <div class="theme-menu" id="theme-menu">
                    <div class="theme-option" data-theme="light" style="background: #f5f5f7; color:#1d1d1f"><i
                            class="fas fa-sun"></i></div>
                    <div class="theme-option" data-theme="dark" style="background: #000; color:#fff"><i
                            class="fas fa-moon"></i></div>
                    <div class="theme-option" data-theme="sakura" style="background: #FFF1F2; color:#881337"><i
                            class="fas fa-fan"></i></div>
                    <div class="theme-option" data-theme="lavender" style="background: #F3E8FF; color:#5B21B6"><i
                            class="fas fa-magic"></i></div>
                </div>
            </div>
            <div class="nav-segment">
                <button class="nav-btn active" onclick="switchView('overview')" id="btn-overview">Á∏ΩË¶Ω</button>
                <button class="nav-btn" onclick="switchView('detail')" id="btn-detail">Ë°åÁ®ã</button>
                <button class="nav-btn" onclick="switchView('checklist')" id="btn-checklist">Á≠ÜË®ò</button>
            </div>
        </div>
    </header>

    <!-- VIEW 1: BENTO GRID OVERVIEW -->
    <div id="view-overview" class="view-container active-view">
        <div class="bento-grid" id="bento-container">
            <!-- JS Injected -->
        </div>
    </div>

    <!-- VIEW 2: SPLIT DETAIL -->
    <div id="view-detail" class="view-container">
        <div class="map-container">
            <div id="map"></div>
        </div>
        <div class="detail-list-panel">
            <div class="date-scroller" id="date-tabs">
                <!-- JS Injected -->
            </div>
            <div class="timeline-wrapper" id="timeline-content">
                <!-- JS Injected -->
            </div>
        </div>
    </div>

    <!-- VIEW 3: CHECKLIST & NOTES (NEW) -->
    <div id="view-checklist" class="view-container">
        <div class="checklist-container" id="checklist-content">
            <!-- JS Injected -->
        </div>
    </div>

    <!-- Password Overlay -->
    <div id="password-overlay">
        <div class="password-container">
            <div class="password-icon"><i class="fas fa-lock"></i></div>
            <h2>TOKYO 2026</h2>
            <p>Ë´ãËº∏ÂÖ•ÂØÜÁ¢º‰ª•Êü•ÁúãË°åÁ®ã</p>
            <div class="input-group">
                <input type="password" id="password-input" placeholder="Ë´ãËº∏ÂÖ•ÂØÜÁ¢º" maxlength="10">
                <button id="password-submit"><i class="fas fa-arrow-right"></i></button>
            </div>
            <div id="password-error" class="error-msg"></div>
        </div>
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script>
        // --- Data Source ---
        const itineraryData = [
            {
                day: "Day 1",
                image: 'assets/day1.png',
                date: "3/6",
                fullDate: "3Êúà6Êó• (ÈÄ±‰∫î)",
                title: "Âá∫Áôº & ÊäµÈÅîÊù±‰∫¨",
                subtitle: "Êæ≥ÈñÄÂá∫ÁôºÔºåÁ∂ìÈ¶ôÊ∏ØÊ©üÂ†¥Áõ¥È£õÊù±‰∫¨ÔºåÂÖ•‰Ωè‰∫åÊ¨°ÂÖÉÊ∞ëÂÆø„ÄÇ",
                gradient: "var(--g-day1)",
                icon: "fa-plane-arrival",
                locations: [
                    { lat: 22.1987, lng: 113.5439, title: "Êæ≥ÈñÄ" },
                    { lat: 22.3080, lng: 113.9185, title: "È¶ôÊ∏ØÂúãÈöõÊ©üÂ†¥" },
                    { lat: 35.7719, lng: 140.3929, title: "ÊàêÁî∞Ê©üÂ†¥" },
                    { lat: 35.6909, lng: 139.7002, title: "Êñ∞ÂÆøÁ´ô" },
                    { lat: 35.6980, lng: 139.6482, title: "Twin Palace Êñ∞È´òÂÜÜÂØ∫" }
                ],
                events: [
                    { time: "09:00", title: "Êæ≥ÈñÄ -> È¶ôÊ∏ØÊ©üÂ†¥", type: "transport", icon: "fa-bus", desc: "Êê≠‰πòÊ∏ØÁè†Êæ≥Â§ßÊ©ãÈáëÂ∑¥ÊàñÂô¥Â∞ÑÈ£õËà™ÂâçÂæÄÈ¶ôÊ∏ØÊ©üÂ†¥„ÄÇ", to: "Êæ≥ÈñÄ" },
                    { time: "14:00", title: "È¶ôÊ∏ØËµ∑È£õ", type: "transport", icon: "fa-plane-departure", desc: "È£õÂæÄÊù±‰∫¨ÊàêÁî∞ (CX/UO/JL)„ÄÇ", to: "È¶ôÊ∏ØÂúãÈöõÊ©üÂ†¥" },
                    { time: "19:05", title: "ÊäµÈÅîÊù±‰∫¨ÊàêÁî∞ (NRT)", type: "transport", icon: "fa-plane-arrival", desc: "Ëæ¶ÁêÜÂÖ•Â¢ÉÊâãÁ∫åÔºåÈ†êË®à 20:30 Âá∫Èóú„ÄÇ", to: "ÊàêÁî∞Ê©üÂ†¥" },
                    { time: "20:45", title: "N'EX ÊàêÁî∞ÁâπÂø´", type: "transport", icon: "fa-train", desc: "Áõ¥ÈÅîÊñ∞ÂÆøÁ´ô (Á¥Ñ 80 ÂàÜÈêò)„ÄÇ", to: "Êñ∞ÂÆøÁ´ô" },
                    { time: "22:15", title: "ËΩâ‰πò & ÊôöÈ§ê", type: "transport", icon: "fa-utensils", desc: "Êñ∞ÂÆøËΩâ‰πò‰∏∏‰πãÂÖßÁ∑öËá≥Êñ∞È´òÂÜÜÂØ∫„ÄÇÊôöÈ§êÔºöÊùæÂ±ãÊàñÂõûÊÜ∂Ê©´‰∏Å„ÄÇ", to: "Êñ∞ÂÆøÁ´ô" },
                    { time: "23:00", title: "ÂÖ•‰Ωè Twin Palace", type: "hotel", icon: "fa-bed", desc: "Âú∞ÂùÄÔºöÊùâ‰∏¶Âå∫Ê¢ÖÈáå 2-18-7„ÄÇ", to: "Twin Palace Êñ∞È´òÂÜÜÂØ∫" }
                ]
            },
            {
                day: "Day 2",
                image: 'assets/day2.png',
                date: "3/7",
                fullDate: "3Êúà7Êó• (ÈÄ±ÂÖ≠)",
                title: "ÁßãËëâÂéü & Ê±†Ë¢ã",
                subtitle: "‰∫åÊ¨°ÂÖÉÊ•µÈôêË≥ºÁâ©ÔºöÁßãËëâÂéüÊ∑òÂØ∂ & Ê±†Ë¢ã‰∏ñÁïåÊúÄÂ§ßÊâ≠ËõãÂ∫ó„ÄÇ",
                gradient: "var(--g-day2)",
                icon: "fa-ghost",
                locations: [
                    { lat: 35.6983, lng: 139.7712, title: "ÁßãËëâÂéü" },
                    { lat: 35.7295, lng: 139.7109, title: "Ê±†Ë¢ã Animate" },
                    { lat: 35.7289, lng: 139.7192, title: "Ê±†Ë¢ã Sunshine City" }
                ],
                events: [
                    { time: "09:30", title: "ÂâçÂæÄÁßãËëâÂéü", type: "transport", icon: "fa-subway", desc: "Êñ∞È´òÂÜÜÂØ∫ -> Âæ°Ëå∂‰πãÊ∞¥ -> ÁßãËëâÂéü„ÄÇ", to: "ÁßãËëâÂéü" },
                    { time: "10:00", title: "ÁßãËëâÂéü ËÅñÂú∞Â∑°Á¶Æ", type: "activity", icon: "fa-ghost", desc: "Radio ÊúÉÈ§®„ÄÅMandarake Complex„ÄÅÈßøÊ≤≥Â±ã„ÄÇ", to: "ÁßãËëâÂéü" },
                    { time: "14:30", title: "ÁßªÂãïËá≥Ê±†Ë¢ã", type: "transport", icon: "fa-train", desc: "JR Â±±ÊâãÁ∑öÁõ¥ÈÅîÊ±†Ë¢ã (20ÂàÜÈêò)„ÄÇ", to: "Ê±†Ë¢ã Animate" },
                    { time: "15:00", title: "Ê±†Ë¢ã Sunshine City", type: "activity", icon: "fa-store", desc: "„Äê2F„ÄëPok√©mon Center Mega Tokyo<br>„Äê3F„Äë‰∏ñÁïåÊúÄÂ§ßÊâ≠ËõãÁôæË≤® (3000+Âè∞Ê©üÂè∞)", to: "Ê±†Ë¢ã Sunshine City" },
                    { time: "20:00", title: "ËøîÂõûÊ∞ëÂÆø", type: "transport", icon: "fa-house", desc: "Ê±†Ë¢ãÊê≠‰πò‰∏∏‰πãÂÖßÁ∑öÁõ¥ÈÅîÊñ∞È´òÂÜÜÂØ∫„ÄÇ", to: "Twin Palace Êñ∞È´òÂÜÜÂØ∫" }
                ]
            },
            {
                day: "Day 3",
                image: 'assets/day3.png',
                date: "3/8",
                fullDate: "3Êúà8Êó• (ÈÄ±Êó•)",
                title: "PokePark & ÊæÄË∞∑",
                subtitle: "ËÆÄË≥£Ê®ÇÂúíÂØ∂ÂèØÂ§¢Â∞àÂçÄÈ´îÈ©ó & ÊæÄË∞∑ÊΩÆÊµÅÂ§ú„ÄÇ",
                gradient: "var(--g-day3)",
                icon: "fa-bolt",
                locations: [
                    { lat: 35.6242, lng: 139.5172, title: "ËÆÄË≥£Ê®ÇÂúí (PokePark)" },
                    { lat: 35.6620, lng: 139.6987, title: "ÊæÄË∞∑ PARCO" }
                ],
                events: [
                    { time: "09:30", title: "ÂâçÂæÄËÆÄË≥£Ê®ÇÂúí", type: "transport", icon: "fa-train", desc: "Êñ∞ÂÆøËΩâ‰∫¨ÁéãÁ∑ö -> ‰∫¨ÁéãËÆÄË≥£Ê®ÇÂúíÁ´ô -> Á∫úËªä„ÄÇ", to: "ËÆÄË≥£Ê®ÇÂúí (PokePark)" },
                    { time: "11:00", title: "ËÆÄË≥£Ê®ÇÂúí", type: "activity", icon: "fa-ticket", desc: "‰ΩøÁî®„ÄêÁ≤æËã±Ë®ìÁ∑¥ÂÆ∂Â•óÁ•®„ÄëÂÖ•Âúí„ÄÇËá™Ë≤ªÈÅäÁé©Èõ≤ÈúÑÈ£õËªä„ÄÇ", to: "ËÆÄË≥£Ê®ÇÂúí (PokePark)" },
                    { time: "15:15", title: "PokePark Ë°®Êºî", type: "poke", icon: "fa-bolt", desc: "Á≤æËã±Á•®Â∞àÂ±¨È†êÁ¥ÑÂ∏≠„ÄÅÁöÆÂç°‰∏òÂêàÁÖß„ÄÇË´ãÊ∫ñÊôÇÂ†±Âà∞ÔºÅ", to: "ËÆÄË≥£Ê®ÇÂúí (PokePark)" },
                    { time: "18:30", title: "ÊæÄË∞∑ PARCO", type: "activity", icon: "fa-bag-shopping", desc: "6FÔºöNintendo Tokyo, Pok√©mon Center Shibuya, Jump Shop„ÄÇ", to: "ÊæÄË∞∑ PARCO" }
                ]
            },
            {
                day: "Day 4",
                image: 'assets/day4.png',
                date: "3/9",
                fullDate: "3Êúà9Êó• (ÈÄ±‰∏Ä)",
                title: "‰∏≠ÈáéÁôæËÄÅÂåØ & ÂØÑ‰ª∂",
                subtitle: "‰∏≠ÈáéÊ∑±Â∫¶ÂÆÖÊåñÂØ∂ & Ë°åÊùéÂØÑÈÄÅËá≥ÊàêÁî∞‰ªªÂãô„ÄÇ",
                gradient: "var(--g-day4)",
                icon: "fa-robot",
                locations: [
                    { lat: 35.7090, lng: 139.6657, title: "‰∏≠ÈáéÁôæËÄÅÂåØ" },
                    { lat: 35.6909, lng: 139.7002, title: "Êñ∞ÂÆøÁ´ô" }
                ],
                events: [
                    { time: "11:00", title: "ÂâçÂæÄ‰∏≠Èáé", type: "transport", icon: "fa-bus", desc: "Áù°È£ΩÈ£Ω„ÄÇÊê≠ÂÖ¨ËªäÊàñÊ≠•Ë°åËá≥‰∏≠Èáé„ÄÇ", to: "‰∏≠ÈáéÁôæËÄÅÂåØ" },
                    { time: "12:00", title: "‰∏≠ÈáéÁôæËÄÅÂåØ", type: "activity", icon: "fa-robot", desc: "Mandarake Á∏ΩÂ∫ó„ÄÅÁµïÁâàÂãïÊº´„ÄÅË≥ΩÁíêÁíêÁï´„ÄÇÊ∑±Â∫¶ÊåñÂØ∂„ÄÇ", to: "‰∏≠ÈáéÁôæËÄÅÂåØ" },
                    { time: "16:00", title: "Êñ∞ÂÆøË£úË≤® & ÂØÑ‰ª∂", type: "transport", icon: "fa-suitcase", desc: "ÈÄõ Bic Camera„ÄÇ‚òÖ ÈáçË¶ÅÔºöÂéªË∂ÖÂïÜÁî®ÈªëË≤ìÂ∞áÂ§ßË°åÊùéÂØÑÂæÄÊàêÁî∞È£ØÂ∫ó„ÄÇ", to: "Êñ∞ÂÆøÁ´ô" }
                ]
            },
            {
                day: "Day 5",
                image: 'assets/day5.png',
                date: "3/10",
                fullDate: "3Êúà10Êó• (ÈÄ±‰∫å)",
                title: "Ê≤≥Âè£Êπñ & Ê∑∫ÈñìÁ•ûÁ§æ",
                subtitle: "ÂØåÂ£´Â±±Ê≤≥Âè£ÊπñÂ∑°Á¶ÆÔºåÂèÉÊãúÂçÉÂπ¥Ê∑∫ÈñìÁ•ûÁ§æ„ÄÇ",
                gradient: "var(--g-day5)",
                icon: "fa-mountain",
                locations: [
                    { lat: 35.4982, lng: 138.7686, title: "Ê≤≥Âè£ÊπñÁ´ô" },
                    { lat: 35.5317, lng: 138.7714, title: "Ê≤≥Âè£Ê∑∫ÈñìÁ•ûÁ§æ" },
                    { lat: 35.5042, lng: 138.7725, title: "Â§©‰∏äÂ±±ÂÖ¨Âúí" },
                    { lat: 35.5224, lng: 138.7616, title: "Èü≥Ê®ÇÊ£ÆÊûó / È§∫È£•‰∏çÂãï" },
                    { lat: 35.4849, lng: 138.7793, title: "MYSTAYS ÂØåÂ£´Â±±Â±ïÊúõÊ∫´Ê≥âÈÖíÂ∫ó" }
                ],
                events: [
                    { time: "08:30", title: "ÂâçÂæÄÊ≤≥Âè£Êπñ", type: "transport", icon: "fa-bus", desc: "Busta Êñ∞ÂÆøÊê≠È´òÈÄüÂ∑¥Â£´ (ÈúÄÈ†êÁ¥Ñ)„ÄÇËªäÁ®ãÁ¥Ñ 1.5 Â∞èÊôÇ„ÄÇ", to: "Ê≤≥Âè£ÊπñÁ´ô" },
                    { time: "11:30", title: "Ê≤≥Âè£ÊπñÂë®ÈÅä", type: "activity", icon: "fa-camera", desc: "Â§©‰∏äÂ±±Á∫úËªä -> È§∫È£•‰∏çÂãïÂçàÈ§ê -> Èü≥Ê®ÇÊ£ÆÊûóÁæéË°ìÈ§®„ÄÇ", to: "Èü≥Ê®ÇÊ£ÆÊûó / È§∫È£•‰∏çÂãï" },
                    { time: "15:00", title: "Ê≤≥Âè£Ê∑∫ÈñìÁ•ûÁ§æ", type: "activity", icon: "fa-torii-gate", desc: "ÂèÉÊãú‰∏ÉÊú¨ÊùâÂçÉÂπ¥Á•ûÊú®„ÄÇË¶ñÈ´îÂäõÂâçÂæÄÂæåÂ±±ÁöÑÂ§©Á©∫È≥•Â±Ö„ÄÇ", to: "Ê≤≥Âè£Ê∑∫ÈñìÁ•ûÁ§æ" },
                    { time: "17:30", title: "ÂÖ•‰Ωè Mystays", type: "hotel", icon: "fa-hot-tub-person", desc: "‰ΩçÊñºÂØåÂ£´ÊÄ•Ê®ÇÂúíÁ´ôÈôÑËøë„ÄÇ‰∫´ÂèóÊ∫´Ê≥â„ÄÇ", to: "MYSTAYS ÂØåÂ£´Â±±Â±ïÊúõÊ∫´Ê≥âÈÖíÂ∫ó" }
                ]
            },
            {
                day: "Day 6",
                image: 'assets/day6.png',
                date: "3/11",
                fullDate: "3Êúà11Êó• (ÈÄ±‰∏â)",
                title: "ÂØåÂ£´ÂêâÁî∞ & Outlet",
                subtitle: "ÂØåÂ£´ÂêâÁî∞Ë°óÊãçÔºåÂ§ßÁßªÂãïËá≥ÊàêÁî∞ Outlet„ÄÇ",
                gradient: "var(--g-day6)",
                icon: "fa-camera-retro",
                locations: [
                    { lat: 35.4912, lng: 138.8039, title: "Êú¨Áî∫‰∫å‰∏ÅÁõÆÂïÜÂ∫óË°ó" },
                    { lat: 35.4862, lng: 138.7967, title: "ÈáëÈ≥•Â±Ö" },
                    { lat: 35.7132, lng: 140.2940, title: "ÈÖíÈÖí‰∫ï Premium Outlets" },
                    { lat: 35.7767, lng: 140.3144, title: "‰∫¨ÊàêÊàêÁî∞Á´ô" }
                ],
                events: [
                    { time: "08:00", title: "Êô®ÈñìÊîùÂΩ±", type: "activity", icon: "fa-camera-retro", desc: "Ê≠•Ë°åËá≥„ÄåÊú¨Áî∫‰∫å‰∏ÅÁõÆ„ÄçÂíå„ÄåÈáëÈ≥•Â±Ö„ÄçÊãçÂØåÂ£´Â±±Ë°óÊôØ„ÄÇ", to: "Êú¨Áî∫‰∫å‰∏ÅÁõÆÂïÜÂ∫óË°ó" },
                    { time: "10:30", title: "ÁßªÂãïËá≥ÊàêÁî∞", type: "transport", icon: "fa-bus", desc: "ÂØåÂ£´Â±±Á´ôÊê≠Â∑¥Â£´ -> Êù±‰∫¨Á´ô -> ËΩâ JR Âø´ÈÄü -> ‰∫¨ÊàêÊàêÁî∞Á´ô„ÄÇ", to: "‰∫¨ÊàêÊàêÁî∞Á´ô" },
                    { time: "15:00", title: "ÂÖ•‰Ωè & È†òË°åÊùé", type: "hotel", icon: "fa-suitcase", desc: "ÂÖ•‰ΩèÊàêÁî∞È£ØÂ∫óÔºåÈ†òÂèñÂØÑÈÄÅÁöÑË°åÊùé„ÄÇ", to: "‰∫¨ÊàêÊàêÁî∞Á´ô" },
                    { time: "15:30", title: "ÈÖíÈÖí‰∫ï Outlet", type: "activity", icon: "fa-bag-shopping", desc: "ËªäÁ´ôÊê≠Â∑¥Â£´Áõ¥ÈÅî„ÄÇÊúÄÂæåË°ùÂà∫Ë≥ºÁâ©„ÄÇ", to: "ÈÖíÈÖí‰∫ï Premium Outlets" }
                ]
            },
            {
                day: "Day 7",
                image: 'assets/day7.png',
                date: "3/12",
                fullDate: "3Êúà12Êó• (ÈÄ±Âõõ)",
                title: "ÊªøËºâÊ≠∏ÈÄî",
                subtitle: "ÊúÄÂæåË£úË≤®ÔºåÊê≠Ê©üËøîÂõûÈ¶ôÊ∏Ø/Êæ≥ÈñÄ„ÄÇ",
                gradient: "var(--g-day7)",
                icon: "fa-plane",
                locations: [
                    { lat: 35.7915, lng: 140.3230, title: "AEON MALL ÊàêÁî∞" },
                    { lat: 35.7719, lng: 140.3929, title: "ÊàêÁî∞Ê©üÂ†¥" }
                ],
                events: [
                    { time: "10:00", title: "AEON MALL ÊàêÁî∞", type: "activity", icon: "fa-cart-shopping", desc: "Êê≠Êé•ÈßÅÂ∑¥Â£´ÂâçÂæÄ„ÄÇË∂ÖÂ∏Ç„ÄÅÁÑ°Âç∞„ÄÅÂ§ßÂâµÊúÄÂæåÊéÉË≤®„ÄÇ", to: "AEON MALL ÊàêÁî∞" },
                    { time: "13:00", title: "ÂâçÂæÄÊ©üÂ†¥", type: "transport", icon: "fa-bus", desc: "Êê≠Â∑¥Â£´Áõ¥ÈÅîÊ©üÂ†¥ (20ÂàÜÈêò)„ÄÇ", to: "ÊàêÁî∞Ê©üÂ†¥" },
                    { time: "15:25", title: "È£õÂæÄÈ¶ôÊ∏Ø", type: "transport", icon: "fa-plane-departure", desc: "Âπ≥ÂÆâÂõûÂÆ∂ÔºÅ", to: "ÊàêÁî∞Ê©üÂ†¥" }
                ]
            }
        ];

        // --- Checklist Data (New) ---
        const checklistData = {
            actions: [
                { text: "Ë≥ºË≤∑ PokePark Á≤æËã±Ë®ìÁ∑¥ÂÆ∂Â•óÁ•®", done: true },
                { text: "È†êË®Ç 3/10 Êñ∞ÂÆø->Ê≤≥Âè£Êπñ Â∑¥Â£´Á•® (ÊèêÂâç1ÂÄãÊúà)", done: false },
                { text: "È†êË®Ç 3/11 Ê≤≥Âè£Êπñ->Êù±‰∫¨ Â∑¥Â£´Á•®", done: false },
                { text: "Ë≥ºË≤∑ Sim Âç° / Áî≥Ë´ãÊº´ÈÅä", done: false },
                { text: "iPhone Âä†ÂÖ• Suica (Ë•øÁìúÂç°)", done: false }
            ],
            strategy: {
                title: "üß≥ Day 5 Ë°åÊùéÊà∞Áï• (‰∏âÈÅ∏‰∏Ä)",
                options: [
                    {
                        title: "ÊñπÊ°à AÔºöÈªëË≤ìÂÆÖÊÄ•‰æø (ÊúÄÊé®Ëñ¶)",
                        desc: "Day 4 Êôö‰∏äÊàñ Day 5 Êó©‰∏äÔºåÂú®Êñ∞È´òÂÜÜÂØ∫ÈôÑËøëÁöÑË∂ÖÂïÜ (7-11/ÂÖ®ÂÆ∂) ÂØÑÈÄÅ„ÄÇÊåáÂÆö Day 6 ÂÖ•‰ΩèÁöÑÊàêÁî∞È£ØÂ∫óÊî∂‰ª∂„ÄÇÂÑ™ÈªûÔºöÂÖ®Á®ãÁ©∫ÊâãÊúÄËºïÈ¨Ü„ÄÇ"
                    },
                    {
                        title: "ÊñπÊ°à BÔºöÊ≤≥Âè£ÊπñÂØÑÂ≠ò & Ëá™Êèê",
                        desc: "Day 5 ÊîúÂ∏∂Ë°åÊùéÊê≠Â∑¥Â£´ÔºåÊäµÈÅîÂæåÂØÑÂ≠òÂú®Ê≤≥Âè£ÊπñÁ´ô (ÁΩÆÁâ©Ê´É/‰∫∫Â∑•ÂØÑÂ≠ò)„ÄÇÈÅäÁé©ÂæåÂõûËªäÁ´ôÈ†òÂèñÔºåÂÜçËá™Ë°åÂ∏∂ÂéªÈ£ØÂ∫ó (Mystays)„ÄÇÁº∫ÈªûÔºöÁßªÂãïËºÉÁ¥Ø„ÄÇ"
                    },
                    {
                        title: "ÊñπÊ°à CÔºöÊñ∞ÂÆøÁ´ôÁΩÆÁâ©Ê´É",
                        desc: "Day 5 Êó©‰∏äÂ∞áÂ§ßË°åÊùéÈéñÂú®Êñ∞ÂÆøÁ´ô Coin Locker„ÄÇDay 6 ÂõûÁ®ãÂøÖÈ†àÊê≠Â∑¥Â£´Âõû„ÄåÊñ∞ÂÆø„ÄçÈ†òÂèñÔºåÂÜçÊê≠ N'EX ÂéªÊàêÁî∞„ÄÇÊ≥®ÊÑèÔºöÂ§ßÂûãÊ´É‰ΩçÊó©‰∏äÁ´∂Áà≠ÊøÄÁÉàÔºå‰∏îÂõûÁ®ãË∑ØÁ∑öÂèóÈôê„ÄÇ"
                    }
                ]
            },
            daily: [
                { day: "Day 1", text: "20:45 Êú´Áè≠ N'EX Ê≥®ÊÑèÊôÇÈñì„ÄÇÊôöÈ§êÂú®Êñ∞È´òÂÜÜÂØ∫Ëß£Ê±∫ËºÉ‰øùÈö™„ÄÇ" },
                { day: "Day 2", text: "Ê±†Ë¢ãÂ§™ÈôΩÂüéÊâ≠ËõãÂ∫óÂú® 3FÔºåÂØ∂ÂèØÂ§¢‰∏≠ÂøÉÂú® 2F„ÄÇÂ∞èÂøÉËø∑Ë∑Ø„ÄÇ" },
                { day: "Day 3", text: "PokePark Ë°®Êºî 15:15 ÈñãÂßãÔºåÂãôÂøÖ 15:00 ÂâçÂ†±Âà∞„ÄÇÁ≤æËã±Á•®Âê´Ë®≠ÊñΩÂÑ™ÂÖàÊ¨ä„ÄÇ" },
                { day: "Day 4", text: "‰∏≠ÈáéÁôæËÄÅÂåØ 12:00 Â∫óÂÆ∂ÊâçÂÖ®ÈñãÔºåÊó©‰∏ä‰∏çÁî®Â§™Êó©Âéª„ÄÇÊôö‰∏äË®òÂæóÂØÑË°åÊùé„ÄÇ" },
                { day: "Day 5", text: "Ê≤≥Âè£ÊπñÁ¥ÖÁ∑öÂ∑¥Â£´‰∫∫Â§öÔºåÈ†êÁïôÊéíÈöäÊôÇÈñì„ÄÇÂ§©Á©∫È≥•Â±ÖÂª∫Ë≠∞Êê≠Ë®àÁ®ãËªä„ÄÇ" },
                { day: "Day 6", text: "Ê∏ÖÊô® 8:00 ÂéªÊú¨Áî∫‰∫å‰∏ÅÁõÆÊãçÁÖß‰∫∫ÊúÄÂ∞ë„ÄÇÊôö‰∏äÈÖíÈÖí‰∫ï Outlet ÁáüÊ•≠Ëá≥ 20:00„ÄÇ" }
            ]
        };

        // --- App Logic ---
        let map;
        let markers = [];
        let isMapInitialized = false;
        let currentTheme = 'light';

        function init() {
            renderBento();
            renderDateTabs();
            renderChecklist(); // New
            loadDayDetail(0);
        }

        // Toggle Checkbox
        window.toggleCheck = function (el) {
            el.classList.toggle('checked');
        }

        // Render Checklist View
        function renderChecklist() {
            const container = document.getElementById('checklist-content');

            // Actions
            let actionsHtml = checklistData.actions.map(item => `
            <div class="action-card">
                <div class="check-circle ${item.done ? 'checked' : ''}" onclick="toggleCheck(this)"></div>
                <span>${item.text}</span>
            </div>
        `).join('');

            // Strategy
            let strategyHtml = `
            <div class="strategy-card">
                <div class="strategy-header"><i class="fas fa-suitcase-rolling" style="font-size:20px; color:var(--accent)"></i> <span class="strategy-title">${checklistData.strategy.title}</span></div>
                ${checklistData.strategy.options.map(opt => `
                    <div class="option-box">
                        <div class="option-title">${opt.title}</div>
                        <div class="option-desc">${opt.desc}</div>
                    </div>
                `).join('')}
            </div>
        `;

            // Daily Cheat Sheet
            let dailyHtml = checklistData.daily.map(item => `
            <div class="cheat-item">
                <div class="cheat-day">${item.day}</div>
                <div class="cheat-content">
                    <h4>ÈáçÈªûÁ≠ÜË®ò</h4>
                    <ul><li>${item.text}</li></ul>
                </div>
            </div>
        `).join('');

            container.innerHTML = `
            <div class="section-title"><i class="fas fa-clipboard-check"></i> Ë°åÂâçÊ∫ñÂÇô & Ë≥ºÁ•®</div>
            <div class="action-grid">${actionsHtml}</div>
            
            ${strategyHtml}
            
            <div class="section-title"><i class="fas fa-calendar-check"></i> ÊØèÊó•ÈÅøÈõ∑ÊåáÂçó</div>
            <div class="cheat-sheet-list">${dailyHtml}</div>
        `;
        }

        // Theme Toggle
        window.toggleTheme = function () {
            const body = document.body;
            if (currentTheme === 'light') {
                body.setAttribute('data-theme', 'dark');
                currentTheme = 'dark';
            } else if (currentTheme === 'dark') {
                body.setAttribute('data-theme', 'sakura');
                currentTheme = 'sakura';
            } else if (currentTheme === 'sakura') {
                body.setAttribute('data-theme', 'lavender');
                currentTheme = 'lavender';
            } else {
                body.removeAttribute('data-theme');
                currentTheme = 'light';
            }

            if (map) {
                let tileUrl = 'https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png';
                if (currentTheme === 'dark') tileUrl = 'https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png';

                map.eachLayer(function (layer) { map.removeLayer(layer); });
                L.tileLayer(tileUrl, { attribution: '&copy; CARTO', subdomains: 'abcd', maxZoom: 19 }).addTo(map);

                const currentDayIndex = document.querySelector('.date-chip.active')?.id.split('-')[1] || 0;
                updateMap(itineraryData[currentDayIndex].locations);
            }
        }

        // Switch Views
        window.switchView = function (viewName) {
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`btn-${viewName}`).classList.add('active');

            document.querySelectorAll('.view-container').forEach(div => div.classList.remove('active-view'));
            document.getElementById(`view-${viewName}`).classList.add('active-view');

            if (viewName === 'detail') {
                setTimeout(() => {
                    if (!isMapInitialized) {
                        initMap();
                        isMapInitialized = true;
                    }
                    map.invalidateSize();
                    // Ensure current day is loaded
                    const activeChip = document.querySelector('.date-chip.active');
                    if (!activeChip) loadDayDetail(0);
                }, 100);
            }
        }

        // Render Overview (Bento Grid)
        function renderBento() {
            const container = document.getElementById('bento-container');
            container.innerHTML = itineraryData.map((day, index) => `
            <div class="bento-card" onclick="switchView('detail'); setTimeout(() => loadDayDetail(${index}), 150);">
                <div class="bento-bg" style="background-image: url('${day.image}')"></div>
                <div class="bento-gradient-overlay" style="background: ${day.gradient}"></div>
                <i class="fas ${day.icon} bento-icon-bg"></i>
                <div class="bento-content">
                    <div class="bento-top">
                        <div class="day-pill">${day.day}</div>
                    </div>
                    <div class="bento-info">
                        <h3>${day.title}</h3>
                        <p>${day.subtitle}</p>
                    </div>
                </div>
            </div>
        `).join('');
        }

        // Render Date Scroller
        function renderDateTabs() {
            const container = document.getElementById('date-tabs');
            container.innerHTML = itineraryData.map((day, index) => `
            <div class="date-chip" onclick="loadDayDetail(${index})" id="tab-${index}">
                <span>${day.day}</span>
                <span>${day.date.split('/')[1]}</span>
            </div>
        `).join('');
        }

        // Load Detail Content
        window.loadDayDetail = function (index) {
            document.querySelectorAll('.date-chip').forEach(c => c.classList.remove('active'));
            document.getElementById(`tab-${index}`).classList.add('active');
            document.getElementById(`tab-${index}`).scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });

            const day = itineraryData[index];
            const timeline = document.getElementById('timeline-content');

            // Helper to find location coordinates
            const findLoc = (name) => {
                return day.locations.find(l => l.title === name || name.includes(l.title) || l.title.includes(name));
            };

            timeline.innerHTML = `
            <div class="day-header-block">
                <h2>${day.title}</h2>
                <p><i class="far fa-calendar-alt"></i> ${day.fullDate} ¬∑ ${day.subtitle}</p>
            </div>
            ${day.events.map((evt, i) => {
                let warningHtml = evt.warning ? `<div class="alert-tag"><i class="fas fa-exclamation-circle"></i> ${evt.warning}</div>` : '';
                const mapLink = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(evt.to)}`;

                let badgeClass = '';
                if (evt.type === 'transport') badgeClass = 'type-transport';
                if (evt.type === 'activity') badgeClass = 'type-activity';
                if (evt.type === 'hotel') badgeClass = 'type-hotel';
                if (evt.type === 'poke') badgeClass = 'type-poke';

                // Route Logic
                let routeHtml = '';
                if (i < day.events.length - 1) {
                    const nextEvt = day.events[i + 1];
                    const fromLoc = findLoc(evt.to);
                    const toLoc = findLoc(nextEvt.to);

                    if (fromLoc && toLoc) {
                        routeHtml = `
                        <div class="route-line-container" onclick="event.stopPropagation(); showRoute(${fromLoc.lat}, ${fromLoc.lng}, ${toLoc.lat}, ${toLoc.lng})" title="ÈªûÊìäÊü•ÁúãË∑ØÂæë">
                            <div class="route-line-visible"></div>
                        </div>`;
                    } else {
                        // Fallback if location not found, just show line
                        routeHtml = `
                        <div class="route-line-container">
                            <div class="route-line-visible"></div>
                        </div>`;
                    }
                }

                return `
                <div class="timeline-item ${badgeClass}" onclick="highlightLocation('${evt.to}')" style="z-index: ${day.events.length - i};">
                    <div class="time-col">
                        ${routeHtml}
                        <span class="time-text">${evt.time}</span>
                        <div class="icon-dot"><i class="fas ${evt.icon}"></i></div>
                    </div>
                    <div class="event-card">
                        <div class="event-title">${evt.title}</div>
                        <div class="event-desc">${evt.desc}</div>
                        ${warningHtml}
                        <a href="${mapLink}" target="_blank" class="nav-link" onclick="event.stopPropagation()">
                            <i class="fas fa-location-arrow"></i> Â∞éËà™
                        </a>
                    </div>
                </div>
                `;
            }).join('')}
        `;

            updateMap(day.locations);
        }

        // Show Route Function
        // Show Route Function
        let routeLine = null;
        window.showRoute = function (lat1, lng1, lat2, lng2) {
            console.log('showRoute called:', lat1, lng1, lat2, lng2);

            if (!map) {
                console.error('Map not initialized');
                return;
            }

            // Ensure numbers
            lat1 = parseFloat(lat1);
            lng1 = parseFloat(lng1);
            lat2 = parseFloat(lat2);
            lng2 = parseFloat(lng2);

            if (isNaN(lat1) || isNaN(lng1) || isNaN(lat2) || isNaN(lng2)) {
                console.error('Invalid coordinates');
                return;
            }

            // Remove existing route line
            if (routeLine) {
                map.removeLayer(routeLine);
            }

            // Get color from CSS variable (check body for dark mode)
            let accentColor = getComputedStyle(document.body).getPropertyValue('--accent').trim();
            if (!accentColor) accentColor = '#007AFF'; // Fallback

            // 1. Draw straight line immediately (as placeholder/fallback)
            const straightLatLngs = [[lat1, lng1], [lat2, lng2]];
            routeLine = L.polyline(straightLatLngs, {
                color: accentColor,
                weight: 6,
                opacity: 0.5,
                dashArray: '10, 10',
                lineCap: 'round'
            }).addTo(map);

            map.flyToBounds(straightLatLngs, { padding: [50, 50], duration: 1.5 });

            // 2. Fetch real route from OSRM (Open Source Routing Machine)
            // Using 'driving' profile as a proxy for general transport paths
            const url = `https://router.project-osrm.org/route/v1/driving/${lng1},${lat1};${lng2},${lat2}?overview=full&geometries=geojson`;

            fetch(url)
                .then(response => response.json())
                .then(data => {
                    if (data.code === 'Ok' && data.routes && data.routes.length > 0) {
                        // Convert GeoJSON [lng, lat] to Leaflet [lat, lng]
                        const coordinates = data.routes[0].geometry.coordinates.map(coord => [coord[1], coord[0]]);

                        if (routeLine) map.removeLayer(routeLine);

                        routeLine = L.polyline(coordinates, {
                            color: accentColor,
                            weight: 6,
                            opacity: 0.9,
                            lineCap: 'round'
                        }).addTo(map);

                        // Adjust view to fit the real path
                        map.flyToBounds(coordinates, { padding: [50, 50], duration: 1.5 });
                    }
                })
                .catch(err => {
                    console.warn('OSRM Routing failed, keeping straight line:', err);
                });
        }

        // Map Functions
        function initMap() {
            map = L.map('map', { zoomControl: false }).setView([35.6909, 139.7002], 11);
            L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
                attribution: '&copy; CARTO',
                subdomains: 'abcd',
                maxZoom: 19
            }).addTo(map);
        }

        function updateMap(locations) {
            if (!map) return;

            // Clear markers
            markers.forEach(m => map.removeLayer(m));
            markers = [];

            if (!locations || locations.length === 0) return;

            const group = new L.featureGroup();

            const customIcon = L.divIcon({
                className: 'custom-marker',
                html: `<div style="background-color: var(--accent); width: 14px; height: 14px; border-radius: 50%; border: 2px solid white; box-shadow: 0 2px 8px rgba(0,0,0,0.3);"></div>`,
                iconSize: [14, 14],
                iconAnchor: [7, 7],
                popupAnchor: [0, -10]
            });

            locations.forEach(loc => {
                const marker = L.marker([loc.lat, loc.lng], { icon: customIcon })
                    .bindPopup(`<b style="font-family:sans-serif">${loc.title}</b>`)
                    .addTo(map);
                marker.options.title = loc.title;
                markers.push(marker);
                group.addLayer(marker);
            });

            map.fitBounds(group.getBounds(), { padding: [50, 50], maxZoom: 14 });
        }

        // Highlight Location Logic
        window.highlightLocation = function (targetName) {
            // Clear route line if exists
            if (routeLine && map) {
                map.removeLayer(routeLine);
                routeLine = null;
            }

            if (!map || markers.length === 0) return;

            const found = markers.find(m =>
                m.options.title === targetName ||
                m.options.title.includes(targetName) ||
                targetName.includes(m.options.title)
            );

            if (found) {
                map.flyTo(found.getLatLng(), 16, { duration: 1.2 });
                setTimeout(() => { found.openPopup(); }, 1200);

                const originalIcon = found.getIcon();
                const highlightIcon = L.divIcon({
                    className: 'custom-marker-highlight',
                    html: `<div style="background-color: #FF3B30; width: 18px; height: 18px; border-radius: 50%; border: 3px solid white; box-shadow: 0 0 0 4px rgba(255, 59, 48, 0.3);"></div>`,
                    iconSize: [18, 18],
                    iconAnchor: [9, 9],
                    popupAnchor: [0, -12]
                });

                found.setIcon(highlightIcon);
                setTimeout(() => { found.setIcon(originalIcon); }, 3000);
            }
        }

        // --- PASSWORD PROTECTION ---
        function checkPassword() {
            const overlay = document.getElementById('password-overlay');
            const input = document.getElementById('password-input');
            const errorMsg = document.getElementById('password-error');
            const container = document.querySelector('.password-container');

            // Check Session
            if (sessionStorage.getItem('is_authenticated') === 'true') {
                overlay.style.display = 'none';
                return;
            }

            function validate() {
                if (input.value === '5201314') {
                    sessionStorage.setItem('is_authenticated', 'true');
                    overlay.style.opacity = '0';
                    setTimeout(() => {
                        overlay.style.display = 'none';
                    }, 500);
                } else {
                    errorMsg.textContent = 'ÂØÜÁ¢ºÈåØË™§';
                    container.classList.remove('shake');
                    void container.offsetWidth; // trigger reflow
                    container.classList.add('shake');
                    input.value = '';
                    input.focus();
                }
            }

            document.getElementById('password-submit').onclick = validate;

            input.addEventListener('keypress', function (e) {
                if (e.key === 'Enter') validate();
            });

            // Focus input on load
            setTimeout(() => input.focus(), 100);
        }

        // Initialize Password Check
        checkPassword();

        // Start
        init();

        // Theme Long Press Logic
        const themeBtn = document.getElementById('theme-btn');
        const themeMenu = document.getElementById('theme-menu');
        const themeOptions = document.querySelectorAll('.theme-option');
        let pressTimer;
        let isMenuOpen = false;

        function openMenu() {
            isMenuOpen = true;
            themeMenu.classList.add('active');
            // Vibrate if supported
            if (navigator.vibrate) navigator.vibrate(50);
        }

        function closeMenu() {
            isMenuOpen = false;
            themeMenu.classList.remove('active');
            themeOptions.forEach(opt => opt.classList.remove('hovered'));
        }

        function handleStart(e) {
            // e.preventDefault(); // Don't prevent default, let click fire if short press
            pressTimer = setTimeout(openMenu, 300);
        }

        function handleEnd(e) {
            clearTimeout(pressTimer);
            if (isMenuOpen) {
                // If menu was open, check if we dropped on an option
                const touch = e.changedTouches ? e.changedTouches[0] : e;
                const target = document.elementFromPoint(touch.clientX, touch.clientY);
                const option = target?.closest('.theme-option');

                if (option) {
                    const theme = option.getAttribute('data-theme');
                    setTheme(theme);
                }
                closeMenu();
                // Prevent click from firing toggle
                e.preventDefault();
                e.stopPropagation();
            }
        }

        function handleMove(e) {
            if (isMenuOpen) {
                e.preventDefault(); // Prevent scrolling while dragging
                const touch = e.touches ? e.touches[0] : e;
                const target = document.elementFromPoint(touch.clientX, touch.clientY);
                const option = target?.closest('.theme-option');

                themeOptions.forEach(opt => opt.classList.remove('hovered'));
                if (option) {
                    option.classList.add('hovered');
                }
            } else {
                // If moved significantly before timer fires, cancel timer (optional, but good for scroll)
                // For now, let's keep it simple.
            }
        }

        themeBtn.addEventListener('mousedown', handleStart);
        themeBtn.addEventListener('touchstart', handleStart, { passive: false });

        window.addEventListener('mouseup', handleEnd);
        window.addEventListener('touchend', handleEnd, { passive: false });

        window.addEventListener('mousemove', handleMove);
        window.addEventListener('touchmove', handleMove, { passive: false });

        // Click Handler (Short Press)
        themeBtn.onclick = function (e) {
            if (!isMenuOpen) {
                toggleTheme();
            }
        };

        function setTheme(theme) {
            const body = document.body;
            body.setAttribute('data-theme', theme);
            currentTheme = theme;
            if (theme === 'light') body.removeAttribute('data-theme');

            // Update Map
            if (map) {
                let tileUrl = 'https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png';
                if (currentTheme === 'dark') tileUrl = 'https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png';

                map.eachLayer(function (layer) {
                    if (layer instanceof L.TileLayer) map.removeLayer(layer);
                });
                L.tileLayer(tileUrl, { attribution: '&copy; CARTO', subdomains: 'abcd', maxZoom: 19 }).addTo(map);
            }
        }

    </script>
</body>

</html>